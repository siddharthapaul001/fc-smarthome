<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Hind:500,600&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css"
        href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="assets/css/main.css">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="assets/js/main.js"></script>
</head>

<body>
    <header>
        <nav>
            <ul>
                <li>
                    <a href="#">
                        <span class="fa fa-user"></span>
                        Hi, <span id="username">Siddhartha</span>
                    </a>
                    <ul class="submenu">
                        <li>
                            <a href="#">
                                <span class="fa fa-sign-out"></span>
                                Logout
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>

    <div class="toggle-container">
        <div class="toggle-wraper">
            <label>Allowed as: </label>
            <div class="toggle-btn-wraper">
                <div id="room-selected" class="selected"></div>
                <button class="btn btn-toggle" onclick="toggleRooms(1)">OWNER</button>
                <button class="btn btn-toggle" onclick="toggleRooms(2)">GUEST</button>
            </div>
        </div>
    </div>
    <section class="rooms-container">
        <section id="own-rooms" class="rooms-own">
            <div id="card-add-room" class="card room add">
                <div class="img-selector">
                    <button class="btn btn-left">&lt;</button>
                    <img src="assets/images/673311-furniture/png/023-kitchen.png" class="room-icon" alt="room-icon"
                        title="room-icon" />
                    <button class="btn btn-right">&gt;</button>
                </div>
                <div class="txt-room-name">
                    <input class="inp" id="inp-room-name" type="text" placeholder="Name the room" />
                </div>
                <div class="stats">
                    <button class="btn btn-add-room">+ Add room</button>
                </div>
            </div>
            <div id="room-inside" class="card room inside" style="display: none;">
                <div id="room-content" style="display: none">
                    <button id="btn-close-room" class="btn btn-close" onclick="closeRoom()">Close</button>
                </div>
            </div>
        </section>
        <section id="guest-rooms" class="rooms-guest">

        </section>
    </section>

    <!-- <footer>
        <div>Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
    </footer> -->

    <script>
        var roomCategory = 1, requestedToggle = false, rooms = [], roomOpened = false;
        var roomSelected = document.getElementById('room-selected'),
            ownRooms = document.getElementById('own-rooms'),
            guestRooms = document.getElementById('guest-rooms'),
            btnAddRoom = document.getElementById('card-add-room'),
            roomInside = document.getElementById('room-inside'),
            btnCloseRoom = document.getElementById('btn-close-room'),
            roomContent = document.getElementById('room-content'),
            roomAttrs = [
                {
                    name: 'Kitchen',
                    icon: 'assets/images/673311-furniture/png/023-kitchen.png'
                },
                {
                    name: 'Bedroom',
                    icon: 'assets/images/205649-furniture-color/png/bed-1.png'
                },
                {
                    name: 'Study',
                    icon: 'assets/images/205649-furniture-color/png/bookcase.png'
                },
                {
                    name: 'Kitchen',
                    icon: 'assets/images/673311-furniture/png/023-kitchen.png'
                },
                {
                    name: 'Bedroom',
                    icon: 'assets/images/205649-furniture-color/png/bed-1.png'
                },
                {
                    name: 'Study',
                    icon: 'assets/images/205649-furniture-color/png/bookcase.png'
                },
                {
                    name: 'Kitchen',
                    icon: 'assets/images/673311-furniture/png/023-kitchen.png'
                },
                {
                    name: 'Bedroom',
                    icon: 'assets/images/205649-furniture-color/png/bed-1.png'
                },
                {
                    name: 'Study',
                    icon: 'assets/images/205649-furniture-color/png/bookcase.png'
                }
            ];

        for (let i = 0; i < roomAttrs.length; i++) {
            rooms.push(new Room(ownRooms, roomAttrs[i], true, btnAddRoom));
        }

        function toggleRooms(category) {
            if (category !== roomCategory) {
                if (roomOpened) {
                    closeRoom();
                }
                if (!requestedToggle) {
                    requestAnimationFrame(() => {
                        roomSelected.setAttribute('style', 'left:' + ((roomCategory - 1) * 50) + '%;right:' + ((2 - roomCategory) * 50) + '%;');
                        ownRooms.style.marginLeft = '-' + ((roomCategory - 1) * 100) + '%';
                        requestedToggle = false;
                    });
                    requestedToggle = true;
                }
                roomCategory = category;
            }
        }

        function openRoom(selectedRoom, id) {
            let selectedRoomIdx, roomsContainer = roomCategory === 1 ? ownRooms : guestRooms;

            if (!roomOpened) {
                roomOpened = true;

                requestAnimationFrame(() => {
                    roomsContainer.style.overflow = 'hidden';

                    let rect = selectedRoom.getBoundingClientRect(),
                        styleStr = 'left:' + rect.left + 'px;top:' + rect.top + 'px;width:' + rect.width + 'px;height:' + (rect.height - 40) + 'px;';
                    roomInside.style = styleStr;
                    roomInside.setAttribute('data-init-style', styleStr);
                    btnAddRoom.style = 'display:none;';

                    setTimeout(() => {
                        rooms[selectedRoomIdx].fadeIn();
                        rect = roomsContainer.getBoundingClientRect();
                        roomInside.style = 'left:' + (rect.left + 20) + 'px;top:' + (rect.top + 20) + 'px;width:' + (rect.width - 40) + 'px;height:' + (window.innerHeight - rect.top - 80) + 'px;';
                        roomContent.style.display = 'block';
                    }, 100);

                });
                rooms.forEach((room, idx) => {
                    if (room._elem.root === selectedRoom) {
                        //room.expand();
                        room.isSelected = true;
                        selectedRoomIdx = idx;
                    } else {
                        room.hide(false);
                    }
                });
            }
        }

        function closeRoom() {
            let roomsContainer = roomCategory === 1 ? ownRooms : guestRooms;
            if (roomOpened) {
                requestAnimationFrame(() => {

                    roomsContainer.style.overflow = 'auto';
                    roomInside.style = roomInside.getAttribute('data-init-style');
                    setTimeout(() => {
                        requestAnimationFrame(() => {
                            roomInside.style = 'opacity: 0;';
                            rooms.forEach((room) => {
                                if (room.isSelected) {
                                    room.isSelected = false;
                                    room.fadeOut(() => {
                                        roomOpened = false;
                                        roomInside.style = 'display:none;';
                                        roomInside.removeAttribute('data-init-style');
                                    });
                                } else {
                                    room.show();
                                    roomContent.style.display = 'none';
                                }
                            });
                        })
                    }, 300);
                });

                setTimeout(() => {
                    requestAnimationFrame(() => {
                        btnAddRoom.removeAttribute('style');
                    });
                }, 600);
            }
        }

        function initView() {
            requestAnimationFrame(() => {
                ownRooms.setAttribute('style', 'max-height:' + (window.innerHeight - ownRooms.offsetTop - 20) + 'px;');
                guestRooms.setAttribute('style', 'max-height:' + (window.innerHeight - ownRooms.offsetTop - 20) + 'px;');
            });
        }

        (() => {
            initView();
        })();
    </script>
</body>

</html>