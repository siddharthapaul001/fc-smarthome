<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Hind:500,600&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css"
        href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="assets/css/main.css">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <script src="assets/js/regulator.js"></script>
    <script src="assets/js/main.js"></script>
</head>

<body>
    <header>
        <nav>
            <ul>
                <li>
                    <div class="toggle-container">
                        <div class="toggle-wraper">
                            <!-- <label>Access: </label> -->
                            <div class="toggle-btn-wraper">
                                <div id="room-selected" class="selected"></div>
                                <button class="btn btn-toggle" onclick="toggleRooms(1)">OWNER</button>
                                <button class="btn btn-toggle" onclick="toggleRooms(2)">GUEST</button>
                            </div>
                        </div>
                    </div>
                </li>
                <li>
                    <a href="#">
                        <span class="fa fa-user"></span>
                        Hi, <span id="username">Siddhartha</span>
                    </a>
                    <ul class="submenu">
                        <li>
                            <a href="#">
                                <span class="fa fa-sign-out"></span>
                                Logout
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>
    <section class="rooms-container">
        <section id="own-rooms" class="rooms-own scroll">
            <!-- <div id="card-add-room" class="card room add">
                <div class="img-selector">
                    <button class="btn btn-left">&lt;</button>
                    <img src="assets/images/673311-furniture/png/023-kitchen.png" class="room-icon" alt="room-icon"
                        title="room-icon" />
                    <button class="btn btn-right">&gt;</button>
                </div>
                <div class="txt-room-name">
                    <input class="inp" id="inp-room-name" type="text" placeholder="Name the room" />
                </div>
                <div class="stats">
                    <button class="btn btn-add-room">+ Add room</button>
                </div>
            </div> -->
        </section>
        <section id="guest-rooms" class="rooms-guest scroll">

        </section>

        <div id="room-inside" class="room-inside" style="display: none;">
            <div id="room-content" style="display:none;">
                <div class="in-room-btns clearfix">
                    <span id="room-name" class="room-name"></span>
                    <button id="btn-close-room" class="btn btn-close" onclick="guests()">
                        <span class="fa fa-2x fa-users"></span></button>
                    <button id="btn-close-room" class="btn btn-close" onclick="closeRoom()"><span
                            class="fa fa-2x fa-remove"></span></button>
                </div>
                <div class="equipments">
                    <div id="equipments" class="equipments-wraper scroll" style="opacity: 0;">

                        <div class="equipment off">
                            <div class="equipment-head">
                                <!-- <span class="fa fa-lightbulb-o"></span> -->
                                <h3>Bulb</h3>
                                <button class="btn btn-remove" onclick="removeEquipment(this)">
                                    <span class="fa fa-trash"></span>
                                </button>
                            </div>
                            <div class="equipment-body">
                                <div class="switch-container">
                                    <div class="selected"></div>
                                    <button class="btn btn-toggle">ON</button>
                                    <button class="btn btn-toggle">OFF</button>
                                </div>
                            </div>
                            <div class="equipment-stats">
                                <!-- <span class="fa fa-lightbulb-o"></span> -->
                                <div class="stat-usage">
                                    <span class="fa fa-line-chart"></span> 0
                                </div>
                                <div class="stat-online">
                                    <span class="fa fa-clock-o"></span> 0
                                </div>
                            </div>
                        </div>
                        <div class="equipment off">
                            <div class="equipment-head">
                                <!-- <span class="fa fa-lightbulb-o"></span> -->
                                <h3>AC</h3>
                                <button class="btn btn-remove" onclick="removeEquipment(this)">
                                    <span class="fa fa-trash"></span>
                                </button>
                            </div>
                            <div id="regulator-test" class="equipment-body">

                            </div>
                            <div class="equipment-stats">
                                <!-- <span class="fa fa-lightbulb-o"></span> -->
                                <div class="stat-usage">
                                    <span class="fa fa-line-chart"></span> 0
                                </div>
                                <div class="stat-online">
                                    <span class="fa fa-clock-o"></span> 0
                                </div>
                            </div>
                        </div>
                        <div class="equipment off">
                            <div class="equipment-head">
                                <!-- <span class="fa fa-lightbulb-o"></span> -->
                                <h3>Bulb</h3>
                                <button class="btn btn-remove" onclick="removeEquipment(this)">
                                    <span class="fa fa-trash"></span>
                                </button>
                            </div>
                            <div class="equipment-body">
                                <div class="switch-container">
                                    <div class="selected"></div>
                                    <button class="btn btn-toggle">ON</button>
                                    <button class="btn btn-toggle">OFF</button>
                                </div>
                            </div>
                            <div class="equipment-stats">
                                <!-- <span class="fa fa-lightbulb-o"></span> -->
                                <div class="stat-usage">
                                    <span class="fa fa-line-chart"></span> 0
                                </div>
                                <div class="stat-online">
                                    <span class="fa fa-clock-o"></span> 0
                                </div>
                            </div>
                        </div>
                        <!-- <div class="equipment on">

                        </div>
                        <div class="equipment off">

                        </div>
                        <div class="equipment off">

                        </div>
                        <div class="equipment">

                        </div>
                        <div class="equipment off">

                        </div>
                        <div class="equipment off">

                        </div>
                        <div class="equipment">

                        </div> -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="modal-container">
        <div class="modal">
            <div id="modal-head" class="modal-head">

            </div>
            <div id="modal-body" class="modal-body">

            </div>
            <div id="modal-footer" class="modal-footer">

            </div>
        </div>
    </div>

    <!-- <footer>
        <div>Icons made by <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> from <a
                href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
    </footer> -->

    <script>
        var roomCategory = 1, requestedToggle = false, rooms = [], equipments = [], roomOpened = false;
        //temp
        var r;
        var roomSelected = document.getElementById('room-selected'),
            ownRooms = document.getElementById('own-rooms'),
            guestRooms = document.getElementById('guest-rooms'),
            //btnAddRoom = document.getElementById('card-add-room'),
            roomInside = document.getElementById('room-inside'),
            btnCloseRoom = document.getElementById('btn-close-room'),
            roomContent = document.getElementById('room-content'),
            equipmentContainer = document.getElementById('equipments'),
            roomAttrs = [
                {
                    name: 'Kitchen',
                    icon: 'assets/images/673311-furniture/png/023-kitchen.png'
                },
                {
                    name: 'Bedroom',
                    icon: 'assets/images/205649-furniture-color/png/bed-1.png'
                },
                {
                    name: 'Study',
                    icon: 'assets/images/205649-furniture-color/png/bookcase.png'
                },
                {
                    name: 'Kitchen',
                    icon: 'assets/images/673311-furniture/png/023-kitchen.png'
                },
                {
                    name: 'Bedroom',
                    icon: 'assets/images/205649-furniture-color/png/bed-1.png'
                },
                {
                    name: 'Study',
                    icon: 'assets/images/205649-furniture-color/png/bookcase.png'
                },
                {
                    name: 'Kitchen',
                    icon: 'assets/images/673311-furniture/png/023-kitchen.png'
                },
                {
                    name: 'Bedroom',
                    icon: 'assets/images/205649-furniture-color/png/bed-1.png'
                },
                {
                    name: 'Study',
                    icon: 'assets/images/205649-furniture-color/png/bookcase.png'
                },
                {
                    name: 'Bedroom',
                    icon: 'assets/images/205649-furniture-color/png/bed-1.png'
                },
                {
                    name: 'Study',
                    icon: 'assets/images/205649-furniture-color/png/bookcase.png'
                }
            ];

        for (let i = roomAttrs.length - 1; i--;) {
            rooms.push(new Room(ownRooms, roomAttrs[i], true));
        }

        for (let i = roomAttrs.length - 3; i--;) {
            rooms.push(new Room(guestRooms, roomAttrs[i], true));
        }

        function toggleRooms(category) {
            if (category !== roomCategory) {
                if (roomOpened) {
                    closeRoom();
                }
                if (!requestedToggle) {
                    requestAnimationFrame(() => {
                        roomSelected.setAttribute('style', 'left:' + ((roomCategory - 1) * 50) + '%;right:' + ((2 - roomCategory) * 50) + '%;');
                        ownRooms.style.marginLeft = '-' + ((roomCategory - 1) * 100) + '%';
                        requestedToggle = false;
                    });
                    requestedToggle = true;
                }
                roomCategory = category;
            }
        }

        function openRoom(selectedRoom, id) {
            let selectedRoomIdx, roomsContainer = roomCategory === 1 ? ownRooms : guestRooms;

            if (!roomOpened) {
                roomOpened = true;

                requestAnimationFrame(() => {
                    roomsContainer.style.overflow = 'hidden';
                    let rect = selectedRoom.getBoundingClientRect(),
                        styleStr = 'left:' + rect.left + 'px;top:' + rect.top + 'px;';//width:' + rect.width + 'px;height:' + (rect.height - 40) + 'px;';
                    roomInside.style = styleStr;
                    roomInside.setAttribute('data-init-style', styleStr);

                    //btnAddRoom.style = 'display:none;';

                    setTimeout(() => {
                        rooms[selectedRoomIdx].fadeIn();
                        requestAnimationFrame(() => {
                            rect = roomsContainer.getBoundingClientRect();
                            roomInside.style = 'left:1%;top:' + (rect.top + 20) + 'px;width:98%;height:' + (window.innerHeight - rect.top - 40) + 'px;';
                            roomContent.style.display = 'block';
                            document.getElementById('room-name').innerHTML = rooms[selectedRoomIdx]._attr.name;
                            setTimeout(() => {
                                requestAnimationFrame(() => {
                                    equipmentContainer.setAttribute('style', 'height:' + (roomInside.offsetHeight - 50) + 'px; opacity:1;');
                                    //equipmentContainer.style.opacity = 1;
                                });
                            }, 300);
                        });
                    }, 100);

                });
                rooms.forEach((room, idx) => {
                    if (room._elem.root === selectedRoom) {
                        //room.expand();
                        room.isSelected = true;
                        selectedRoomIdx = idx;
                    } else {
                        room.hide(false);
                    }
                });
            }
        }

        function closeRoom() {
            let roomsContainer = roomCategory === 1 ? ownRooms : guestRooms;
            if (roomOpened) {
                requestAnimationFrame(() => {
                    equipmentContainer.style.opacity = 0;
                    setTimeout(() => {
                        requestAnimationFrame(() => {
                            roomsContainer.style.overflow = 'auto';
                            roomInside.style = roomInside.getAttribute('data-init-style');
                            setTimeout(() => {
                                requestAnimationFrame(() => {
                                    roomInside.style.opacity = 0;
                                    rooms.forEach((room) => {
                                        if (room.isSelected) {
                                            room.isSelected = false;
                                            room.fadeOut(() => {
                                                roomOpened = false;
                                                roomInside.style = 'display:none;';
                                                roomInside.removeAttribute('data-init-style');
                                            });
                                        } else {
                                            room.show();
                                            roomContent.style.display = 'none';
                                        }
                                    });
                                })
                            }, 300);
                        });
                    }, 300);
                });
            }
        }

        function initView() {
            requestAnimationFrame(() => {
                ownRooms.setAttribute('style', 'max-height:' + (window.innerHeight - ownRooms.offsetTop - 20) + 'px;');
                guestRooms.setAttribute('style', 'max-height:' + (window.innerHeight - ownRooms.offsetTop - 20) + 'px;');
            });
        }
        (() => {
            initView();
            //Created to test only
            r = new Regulator(
                document.getElementById('regulator-test'),
                140, '#1c90dd', '#aaa', '#aaa', '#477201', 10, 2
            );
            r.setValue(72);
        })();
    </script>
</body>

</html>